{% extends 'base.html' %}
{% load basename_filter %}

{% block title %}Materials for {{ subject.name }} ({{ subject.code }}){% endblock %}

{% block content %}
<h2>Materials for [{{ selected_subject.code }} - {{ selected_subject.name }}]</h2>
<form method="GET" action="{% url 'student_materials:select_material' %}">
    <!-- Subject selection, File category selection, and Download button -->
    <div class="row">
        <div class="col-sm-6">
            <!-- Training Program Selection -->
            <select id="trainingProgramSelect" name="training_program_id" class="form-control" onchange="this.form.submit()">
                <option value="0">-- Select a training program --</option>
                {% for program in training_programs %}
                    <option value="{{ program.id }}" {% if program.id == selected_training_program.id %}selected{% endif %}>
                        {{ program.program_name }}
                    </option>
                {% empty %}
                    <option value="">No training programs available</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-sm-6">
            <!-- Subject Selection -->
            <select id="subjectSelect" name="subject_id" class="form-control" onchange="this.form.submit()">
                <option value="0">-- Select a subject --</option>
                {% for subject in subjects %}
                    <option value="{{ subject.id }}" {% if subject.id == selected_subject.id %}selected{% endif %}>
                        {{ subject.name }}
                    </option>
                {% empty %}
                    <option value="">No subjects available</option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    <div class="row">
        <div class="col-sm-6">
            <select class="form-control" id="fileSelect" name="fileSelect" onchange="this.form.submit()">
                <option value="0">-- Select a category-- </option>
                <option value="assignments" {% if fileSelect == 'assignments' %}selected{% endif %}>
                    Assignments ({{ assignments|length }} files)
                </option>
                <option value="labs" {% if fileSelect == 'labs' %}selected{% endif %}>
                    Labs ({{ labs|length }} files)
                </option>
                <option value="lectures" {% if fileSelect == 'lectures' %}selected{% endif %}>
                    Lectures ({{ lectures|length }} files)
                </option>
                <option value="references" {% if fileSelect == 'references' %}selected{% endif %}>
                    References ({{ references|length }} files)
                </option>
            </select>
        </div>
        <div class="col-sm-6">  <!-- Aligns the button to the right -->
            <a href="{% url 'subject:download_all_materials' fileSelect %}" class="btn btn-primary mb-5">
                <i class="fas fa-download"></i> Download All 
            </a>
        </div>
    </div>
    
</form>


<!-- Material listing table -->
<div class="container mt-4">
    
    <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 40%;">File Name</th>
                    <th style="width: 15%;">File Type</th>
                    <th style="width: 20%;">File Size</th>
                    <th style="width: 20%;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for material in materials %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td style="width: 40%;">
                        <a href="{% url 'student_materials:view_material' material.id %}" title="View Material" target="_blank">
                            {{ material.file.name|basename }}
                        </a>
                    </td>
                    <td>{{ material.get_file_type }}</td>
                    <td>{{ material.file.size|filesizeformat }}</td>
                    <td>
                        <a href="{{ material.file.url }}" class="btn btn-primary btn-sm" download>
                            <i class="fas fa-download"></i>
                        </a>
                        <a href="{% url 'student_materials:view_material' material.id %}" title="View Material" class="btn btn-info btn-sm" target="_blank">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">No material available for this category.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
